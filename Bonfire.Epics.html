<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.38.2">
    <meta name="project" content="Bonfire v1.0.0-social-rc.1.10">


    <title>Bonfire.Epics â€” Bonfire v1.0.0-social-rc.1.10</title>

    <link rel="stylesheet" href="dist/html-elixir-KV3YOVJ3.css" />

    <script defer src="dist/sidebar_items-09D6F6F4.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-DPJLHKSM.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="https://bonfirenetworks.org" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="Bonfire" />
        </a>

      <div>
        <a href="https://bonfirenetworks.org" class="sidebar-projectName" translate="no">
Bonfire
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v1.0.0-social-rc.1.10
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-module" id="main" data-type="modules">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of Bonfire</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>
      <span translate="no">Bonfire.Epics</span> 
      <small class="app-vsn" translate="no">(Bonfire v1.0.0-social-rc.1.10)</small>

    </h1>

      <a href="https://github.com/bonfire-networks/bonfire_epics/blob/main/lib/epics.ex#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


    <section id="moduledoc">
<p>Epics are a extensible way of structuring tasks.</p><p>This library is designed to provide a structured way to define and execute complex workflows in Elixir applications. It introduces the concept of &quot;Epics&quot; and &quot;Acts&quot; to organize and run sequences of operations.</p><h2 id="module-key-components-and-concepts" class="section-heading"><a href="#module-key-components-and-concepts" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Key components and concepts:</span></h2><ul><li><a href="./Bonfire.Epics.Epic.html"><code class="inline">Bonfire.Epics.Epic</code></a>: An Epic represents a complete workflow or process. It's a container that holds a sequence of Acts to be executed, along with state information, errors, and assigned values.</li><li><a href="./Bonfire.Epics.Act.html"><code class="inline">Bonfire.Epics.Act</code></a>: An Act is an individual step or operation within an Epic. Each Act is typically a module that implements a specific task or functionality.</li><li>Execution Flow &amp; Parallel Execution: Epics are executed by running their Acts in sequence. The library provides mechanisms to define, modify, and run these sequences. The library supports running multiple Acts in parallel for improved performance in certain scenarios.</li><li>Shared State: An Epic can maintain state throughout its execution using the 'assigns' map, allowing data to be passed between Acts.</li><li>Configurable: Epics can be defined in configuration, including at runtime, making it easy to set up and modify workflows without changing code.</li><li>Database Transactions: See the <a href="./Bonfire.Ecto.html"><code class="inline">Bonfire.Ecto</code></a> library for helpers to queue changeset operations within Acts and then run them all together in a single transaction: <a href="https://github.com/bonfire-networks/bonfire_ecto">https://github.com/bonfire-networks/bonfire_ecto</a></li><li>Error Handling: The library includes built-in error handling, allowing errors to be captured and associated with specific Acts within an Epic.</li></ul><p>This library is particularly useful for applications that need to manage complex, multi-step tasks with error handling and state management. It provides a flexible and extensible way to define, configure, and execute these processes, making it easier to maintain and modify complex workflows.</p><h2 id="module-how-it-works" class="section-heading"><a href="#module-how-it-works" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">How it works</span></h2><ol><li>Each Act is implemented as a module with a <code class="inline">run/2</code> function that performs a specific task.</li><li>Users define an Epic, either in code or configuration, as sequences of Acts.</li><li>When the Epic is run, it executes each Act in sequence (or with some Acts optionally running in parallel), maintaining state and handling errors along the way. Acts can update the Epic's state, adding errors, and assigning values that can be used by subsequent Acts.</li><li>After all Acts are executed, the final state of the Epic is returned, including any errors or assigned values.</li></ol><h2 id="module-1-how-to-write-an-act" class="section-heading"><a href="#module-1-how-to-write-an-act" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">1. How to write an Act</span></h2><p>Write a module with a <code class="inline">run/2</code> function that takes an Epic and an Act, performs a specific task, and returns an Epic.</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">Bonfire.Label.Acts.LabelObject</span><span class="w"> </span><span class="k" data-group-id="3628423248-1">do</span><span class="w">
  </span><span class="na">@moduledoc</span><span class="w"> </span><span class="s">&quot;&quot;&quot;
  Takes an object and label and returns a changeset for labeling that object. 
  Implements `Bonfire.Epics.Act`.

  Epic Options:
    * `:current_user` - user that will create the page, required.

  Act Options:
    * `:as` - key to where we find the label(s) to add, and then assign changeset to, default: `:label`.
    * `:object` (configurable) - id to use for the thing to label
    * `:attrs` - epic options key to find the attributes at, default: `:attrs`.
  &quot;&quot;&quot;</span><span class="w">

  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Arrows</span><span class="w">
  </span><span class="kn">import</span><span class="w"> </span><span class="nc">Bonfire.Epics</span><span class="w">

  </span><span class="na">@doc</span><span class="w"> </span><span class="no">false</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">run</span><span class="p" data-group-id="3628423248-2">(</span><span class="n">epic</span><span class="p">,</span><span class="w"> </span><span class="n">act</span><span class="p" data-group-id="3628423248-2">)</span><span class="w"> </span><span class="k" data-group-id="3628423248-3">do</span><span class="w">
    </span><span class="n">current_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Bonfire.Common.Utils</span><span class="o">.</span><span class="n">current_user</span><span class="p" data-group-id="3628423248-4">(</span><span class="n">epic</span><span class="o">.</span><span class="n">assigns</span><span class="p" data-group-id="3628423248-5">[</span><span class="ss">:options</span><span class="p" data-group-id="3628423248-5">]</span><span class="p" data-group-id="3628423248-4">)</span><span class="w">

    </span><span class="k">cond</span><span class="w"> </span><span class="k" data-group-id="3628423248-6">do</span><span class="w">
      </span><span class="n">epic</span><span class="o">.</span><span class="n">errors</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="p" data-group-id="3628423248-7">[</span><span class="p" data-group-id="3628423248-7">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">maybe_debug</span><span class="p" data-group-id="3628423248-8">(</span><span class="w">
          </span><span class="n">epic</span><span class="p">,</span><span class="w">
          </span><span class="n">act</span><span class="p">,</span><span class="w">
          </span><span class="n">length</span><span class="p" data-group-id="3628423248-9">(</span><span class="n">epic</span><span class="o">.</span><span class="n">errors</span><span class="p" data-group-id="3628423248-9">)</span><span class="p">,</span><span class="w">
          </span><span class="s">&quot;Skipping due to epic errors&quot;</span><span class="w">
        </span><span class="p" data-group-id="3628423248-8">)</span><span class="w">

        </span><span class="n">epic</span><span class="w">

      </span><span class="ow">not</span><span class="w"> </span><span class="p" data-group-id="3628423248-10">(</span><span class="n">is_struct</span><span class="p" data-group-id="3628423248-11">(</span><span class="n">current_user</span><span class="p" data-group-id="3628423248-11">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">is_binary</span><span class="p" data-group-id="3628423248-12">(</span><span class="n">current_user</span><span class="p" data-group-id="3628423248-12">)</span><span class="p" data-group-id="3628423248-10">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">maybe_debug</span><span class="p" data-group-id="3628423248-13">(</span><span class="w">
          </span><span class="n">epic</span><span class="p">,</span><span class="w">
          </span><span class="n">act</span><span class="p">,</span><span class="w">
          </span><span class="n">current_user</span><span class="p">,</span><span class="w">
          </span><span class="s">&quot;Skipping due to missing current_user&quot;</span><span class="w">
        </span><span class="p" data-group-id="3628423248-13">)</span><span class="w">

        </span><span class="n">epic</span><span class="w">

      </span><span class="no">true</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">as</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Keyword</span><span class="o">.</span><span class="n">get</span><span class="p" data-group-id="3628423248-14">(</span><span class="n">act</span><span class="o">.</span><span class="n">options</span><span class="p">,</span><span class="w"> </span><span class="ss">:as</span><span class="p" data-group-id="3628423248-14">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nc">Keyword</span><span class="o">.</span><span class="n">get</span><span class="p" data-group-id="3628423248-15">(</span><span class="n">act</span><span class="o">.</span><span class="n">options</span><span class="p">,</span><span class="w"> </span><span class="ss">:on</span><span class="p">,</span><span class="w"> </span><span class="ss">:label</span><span class="p" data-group-id="3628423248-15">)</span><span class="w">
        </span><span class="n">object_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Keyword</span><span class="o">.</span><span class="n">get</span><span class="p" data-group-id="3628423248-16">(</span><span class="n">act</span><span class="o">.</span><span class="n">options</span><span class="p">,</span><span class="w"> </span><span class="ss">:object</span><span class="p">,</span><span class="w"> </span><span class="ss">:object</span><span class="p" data-group-id="3628423248-16">)</span><span class="w">

        </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Keyword</span><span class="o">.</span><span class="n">get</span><span class="p" data-group-id="3628423248-17">(</span><span class="n">epic</span><span class="o">.</span><span class="n">assigns</span><span class="p" data-group-id="3628423248-18">[</span><span class="ss">:options</span><span class="p" data-group-id="3628423248-18">]</span><span class="p">,</span><span class="w"> </span><span class="n">as</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3628423248-19">[</span><span class="p" data-group-id="3628423248-19">]</span><span class="p" data-group-id="3628423248-17">)</span><span class="w">
        </span><span class="n">object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Keyword</span><span class="o">.</span><span class="n">get</span><span class="p" data-group-id="3628423248-20">(</span><span class="n">epic</span><span class="o">.</span><span class="n">assigns</span><span class="p" data-group-id="3628423248-21">[</span><span class="ss">:options</span><span class="p" data-group-id="3628423248-21">]</span><span class="p">,</span><span class="w"> </span><span class="n">object_key</span><span class="p">,</span><span class="w"> </span><span class="no">nil</span><span class="p" data-group-id="3628423248-20">)</span><span class="w">

        </span><span class="nc">Bonfire.Label.Labelling</span><span class="o">.</span><span class="n">label_object</span><span class="p" data-group-id="3628423248-22">(</span><span class="n">label</span><span class="p">,</span><span class="w"> </span><span class="n">object</span><span class="p">,</span><span class="w">
          </span><span class="ss">return</span><span class="p">:</span><span class="w"> </span><span class="ss">:changeset</span><span class="p">,</span><span class="w">
          </span><span class="ss">current_user</span><span class="p">:</span><span class="w"> </span><span class="n">current_user</span><span class="w">
        </span><span class="p" data-group-id="3628423248-22">)</span><span class="w">
        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Map</span><span class="o">.</span><span class="n">put</span><span class="p" data-group-id="3628423248-23">(</span><span class="ss">:action</span><span class="p">,</span><span class="w"> </span><span class="ss">:insert</span><span class="p" data-group-id="3628423248-23">)</span><span class="w">
        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Bonfire.Epics.Epic</span><span class="o">.</span><span class="n">assign</span><span class="p" data-group-id="3628423248-24">(</span><span class="n">epic</span><span class="p">,</span><span class="w"> </span><span class="n">as</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="3628423248-24">)</span><span class="w">
        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Bonfire.Ecto.Acts.Work</span><span class="o">.</span><span class="n">add</span><span class="p" data-group-id="3628423248-25">(</span><span class="ss">:label</span><span class="p" data-group-id="3628423248-25">)</span><span class="w">
    </span><span class="k" data-group-id="3628423248-6">end</span><span class="w">
  </span><span class="k" data-group-id="3628423248-3">end</span><span class="w">
</span><span class="k" data-group-id="3628423248-1">end</span></code></pre><h2 id="module-2-how-to-define-an-epic" class="section-heading"><a href="#module-2-how-to-define-an-epic" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">2. How to define an Epic</span></h2><h3 id="module-simple-epic-where-each-act-executes-sequentially" class="section-heading"><a href="#module-simple-epic-where-each-act-executes-sequentially" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Simple Epic where each Act executes sequentially</span></h3><pre><code class="makeup elixir" translate="no"><span class="w">     </span><span class="na">@page_act_opts</span><span class="w"> </span><span class="p" data-group-id="6915802183-1">[</span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="ss">:page</span><span class="p">,</span><span class="w"> </span><span class="ss">attrs</span><span class="p">:</span><span class="w"> </span><span class="ss">:page_attrs</span><span class="p" data-group-id="6915802183-1">]</span><span class="w">

     </span><span class="n">config</span><span class="w"> </span><span class="ss">:bonfire_pages</span><span class="p">,</span><span class="w"> </span><span class="nc">Bonfire.Pages</span><span class="p">,</span><span class="w">
      </span><span class="ss">epics</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6915802183-2">[</span><span class="w">
        </span><span class="ss">create</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6915802183-3">[</span><span class="w">
          </span><span class="c1"># Create a changeset for insertion</span><span class="w">
          </span><span class="p" data-group-id="6915802183-4">{</span><span class="nc">Bonfire.Pages.Acts.Page.Create</span><span class="p">,</span><span class="w"> </span><span class="na">@page_act_opts</span><span class="p" data-group-id="6915802183-4">}</span><span class="p">,</span><span class="w">
          </span><span class="c1"># with a sanitised body and tags extracted,</span><span class="w">
          </span><span class="p" data-group-id="6915802183-5">{</span><span class="nc">Bonfire.Social.Acts.PostContents</span><span class="p">,</span><span class="w"> </span><span class="na">@page_act_opts</span><span class="p" data-group-id="6915802183-5">}</span><span class="p">,</span><span class="w">
          </span><span class="c1"># a caretaker,</span><span class="w">
          </span><span class="p" data-group-id="6915802183-6">{</span><span class="nc">Bonfire.Me.Acts.Caretaker</span><span class="p">,</span><span class="w"> </span><span class="na">@page_act_opts</span><span class="p" data-group-id="6915802183-6">}</span><span class="p">,</span><span class="w">
          </span><span class="c1"># and a creator,</span><span class="w">
          </span><span class="p" data-group-id="6915802183-7">{</span><span class="nc">Bonfire.Me.Acts.Creator</span><span class="p">,</span><span class="w"> </span><span class="na">@page_act_opts</span><span class="p" data-group-id="6915802183-7">}</span><span class="p">,</span><span class="w">
          </span><span class="c1"># and possibly fetch contents of URLs,</span><span class="w">
          </span><span class="p" data-group-id="6915802183-8">{</span><span class="nc">Bonfire.Files.Acts.URLPreviews</span><span class="p">,</span><span class="w"> </span><span class="na">@page_act_opts</span><span class="p" data-group-id="6915802183-8">}</span><span class="p">,</span><span class="w">
          </span><span class="c1"># possibly with uploaded files,</span><span class="w">
          </span><span class="p" data-group-id="6915802183-9">{</span><span class="nc">Bonfire.Files.Acts.AttachMedia</span><span class="p">,</span><span class="w"> </span><span class="na">@page_act_opts</span><span class="p" data-group-id="6915802183-9">}</span><span class="p">,</span><span class="w">
          </span><span class="c1"># with extracted tags fully hooked up,</span><span class="w">
          </span><span class="p" data-group-id="6915802183-10">{</span><span class="nc">Bonfire.Tag.Acts.Tag</span><span class="p">,</span><span class="w"> </span><span class="na">@page_act_opts</span><span class="p" data-group-id="6915802183-10">}</span><span class="p">,</span><span class="w">
          </span><span class="c1"># and the appropriate boundaries established,</span><span class="w">
          </span><span class="p" data-group-id="6915802183-11">{</span><span class="nc">Bonfire.Boundaries.Acts.SetBoundaries</span><span class="p">,</span><span class="w"> </span><span class="na">@page_act_opts</span><span class="p" data-group-id="6915802183-11">}</span><span class="p">,</span><span class="w">

          </span><span class="c1"># Now we open a Postgres transaction and actually do the insertions in DB</span><span class="w">
          </span><span class="nc">Bonfire.Ecto.Acts.Begin</span><span class="p">,</span><span class="w">
          </span><span class="c1"># Run our inserts</span><span class="w">
          </span><span class="nc">Bonfire.Ecto.Acts.Work</span><span class="p">,</span><span class="w">
          </span><span class="nc">Bonfire.Ecto.Acts.Commit</span><span class="p">,</span><span class="w">

          </span><span class="c1"># Enqueue for indexing by meilisearch</span><span class="w">
          </span><span class="p" data-group-id="6915802183-12">{</span><span class="nc">Bonfire.Search.Acts.Queue</span><span class="p">,</span><span class="w"> </span><span class="na">@page_act_opts</span><span class="p" data-group-id="6915802183-12">}</span><span class="w">
        </span><span class="p" data-group-id="6915802183-3">]</span><span class="w">
      </span><span class="p" data-group-id="6915802183-2">]</span></code></pre><h3 id="module-advanced-epic-where-some-acts-execute-in-parallel" class="section-heading"><a href="#module-advanced-epic-where-some-acts-execute-in-parallel" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Advanced Epic, where some Acts execute in parallel</span></h3><pre><code class="makeup elixir" translate="no"><span class="w">    </span><span class="n">config</span><span class="w"> </span><span class="ss">:bonfire_posts</span><span class="p">,</span><span class="w"> </span><span class="nc">Bonfire.Posts</span><span class="p">,</span><span class="w">
      </span><span class="ss">epics</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1754160759-1">[</span><span class="w">
        </span><span class="ss">publish</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1754160759-2">[</span><span class="w">
          </span><span class="c1"># Create a changeset for insertion</span><span class="w">
          </span><span class="nc">Bonfire.Posts.Acts.Posts.Publish</span><span class="p">,</span><span class="w">
          </span><span class="c1"># These next 3 Acts are run in parallel</span><span class="w">
          </span><span class="p" data-group-id="1754160759-3">[</span><span class="w">
            </span><span class="c1"># with a sanitised body and tags extracted,</span><span class="w">
            </span><span class="p" data-group-id="1754160759-4">{</span><span class="nc">Bonfire.Social.Acts.PostContents</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="ss">:post</span><span class="p" data-group-id="1754160759-4">}</span><span class="p">,</span><span class="w">

            </span><span class="c1"># assign a caretaker,</span><span class="w">
            </span><span class="p" data-group-id="1754160759-5">{</span><span class="nc">Bonfire.Me.Acts.Caretaker</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="ss">:post</span><span class="p" data-group-id="1754160759-5">}</span><span class="p">,</span><span class="w">

            </span><span class="c1"># record the creator,</span><span class="w">
            </span><span class="p" data-group-id="1754160759-6">{</span><span class="nc">Bonfire.Me.Acts.Creator</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="ss">:post</span><span class="p" data-group-id="1754160759-6">}</span><span class="w">
          </span><span class="p" data-group-id="1754160759-3">]</span><span class="p">,</span><span class="w">
          </span><span class="c1"># These next 4 Acts are run in parallel (they run after the previous 3 because they depend on the outputs of those Acts)</span><span class="w">
          </span><span class="p" data-group-id="1754160759-7">[</span><span class="w">
            </span><span class="c1"># possibly fetch contents of URLs,</span><span class="w">
            </span><span class="p" data-group-id="1754160759-8">{</span><span class="nc">Bonfire.Files.Acts.URLPreviews</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="ss">:post</span><span class="p" data-group-id="1754160759-8">}</span><span class="p">,</span><span class="w">

            </span><span class="c1"># possibly occurring in a thread,</span><span class="w">
            </span><span class="p" data-group-id="1754160759-9">{</span><span class="nc">Bonfire.Social.Acts.Threaded</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="ss">:post</span><span class="p" data-group-id="1754160759-9">}</span><span class="p">,</span><span class="w">

            </span><span class="c1"># with extracted tags/mentions fully hooked up,</span><span class="w">
            </span><span class="p" data-group-id="1754160759-10">{</span><span class="nc">Bonfire.Tag.Acts.Tag</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="ss">:post</span><span class="p" data-group-id="1754160759-10">}</span><span class="p">,</span><span class="w">

            </span><span class="c1"># maybe set as sensitive,</span><span class="w">
            </span><span class="p" data-group-id="1754160759-11">{</span><span class="nc">Bonfire.Social.Acts.Sensitivity</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="ss">:post</span><span class="p" data-group-id="1754160759-11">}</span><span class="w">
          </span><span class="p" data-group-id="1754160759-7">]</span><span class="p">,</span><span class="w">
          </span><span class="c1"># These next 3 Acts are run in parallel (they run after the previous 4 because they depend on the outputs of those Acts)</span><span class="w">
          </span><span class="p" data-group-id="1754160759-12">[</span><span class="w">
            </span><span class="c1"># possibly with uploaded/linked media (optionally depends on URLPreviews),</span><span class="w">
            </span><span class="p" data-group-id="1754160759-13">{</span><span class="nc">Bonfire.Files.Acts.AttachMedia</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="ss">:post</span><span class="p" data-group-id="1754160759-13">}</span><span class="p">,</span><span class="w">

            </span><span class="c1"># with appropriate boundaries established (depends on Threaded),</span><span class="w">
            </span><span class="p" data-group-id="1754160759-14">{</span><span class="nc">Bonfire.Boundaries.Acts.SetBoundaries</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="ss">:post</span><span class="p" data-group-id="1754160759-14">}</span><span class="p">,</span><span class="w">

            </span><span class="c1"># summarised by an activity (possibly appearing in feeds),</span><span class="w">
            </span><span class="p" data-group-id="1754160759-15">{</span><span class="nc">Bonfire.Social.Acts.Activity</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="ss">:post</span><span class="p" data-group-id="1754160759-15">}</span><span class="w">
          </span><span class="p" data-group-id="1754160759-12">]</span><span class="p">,</span><span class="w">

          </span><span class="c1"># Now we open a Postgres transaction and actually do the insertions in DB</span><span class="w">
          </span><span class="nc">Bonfire.Ecto.Acts.Begin</span><span class="p">,</span><span class="w">
          </span><span class="c1"># Run our inserts</span><span class="w">
          </span><span class="nc">Bonfire.Ecto.Acts.Work</span><span class="p">,</span><span class="w">
          </span><span class="nc">Bonfire.Ecto.Acts.Commit</span><span class="p">,</span><span class="w">

          </span><span class="c1"># Preload data &amp; Publish live feed updates via (in-memory) PubSub</span><span class="w">
          </span><span class="p" data-group-id="1754160759-16">{</span><span class="nc">Bonfire.Social.Acts.LivePush</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="ss">:post</span><span class="p" data-group-id="1754160759-16">}</span><span class="p">,</span><span class="w">

          </span><span class="c1"># These steps are run in parallel</span><span class="w">
          </span><span class="p" data-group-id="1754160759-17">[</span><span class="w">
            </span><span class="c1"># Enqueue for indexing by meilisearch</span><span class="w">
            </span><span class="p" data-group-id="1754160759-18">{</span><span class="nc">Bonfire.Search.Acts.Queue</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="ss">:post</span><span class="p" data-group-id="1754160759-18">}</span><span class="p">,</span><span class="w">

            </span><span class="c1"># Prepare JSON for federation and add to queue (oban).</span><span class="w">
            </span><span class="p" data-group-id="1754160759-19">{</span><span class="nc">Bonfire.Social.Acts.Federate</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="ss">:post</span><span class="p" data-group-id="1754160759-19">}</span><span class="w">
          </span><span class="p" data-group-id="1754160759-17">]</span><span class="p">,</span><span class="w">

          </span><span class="c1"># Once the activity/object exists (depends on federation being done)</span><span class="w">
          </span><span class="p" data-group-id="1754160759-20">{</span><span class="nc">Bonfire.Tags.Acts.AutoBoost</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="ss">:post</span><span class="p" data-group-id="1754160759-20">}</span><span class="w">
        </span><span class="p" data-group-id="1754160759-2">]</span><span class="w">
      </span><span class="p" data-group-id="1754160759-1">]</span></code></pre><h2 id="module-3-how-to-run-an-epic" class="section-heading"><a href="#module-3-how-to-run-an-epic" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">3. How to run an Epic</span></h2><pre><code class="makeup elixir" translate="no"><span class="nc">Bonfire.Epics</span><span class="o">.</span><span class="n">run_epic</span><span class="p" data-group-id="1351034015-1">(</span><span class="nc">Bonfire.Posts</span><span class="p">,</span><span class="w"> </span><span class="ss">:publish</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="ss">:post</span><span class="p" data-group-id="1351034015-1">)</span></code></pre><h2 id="module-copyright-and-license" class="section-heading"><a href="#module-copyright-and-license" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Copyright and License</span></h2><p>Copyright (c) 2022 Bonfire Contributors</p><p>Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p><p>   <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p><p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>
    </section>

</div>

  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Summary</span>
    </h1>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#maybe_debug/3" data-no-tooltip="" translate="no">maybe_debug(act_or_epic, thing, label \\ nil)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#maybe_debug/4" data-no-tooltip="" translate="no">maybe_debug(epic, act, thing, label)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#run_epic/3" data-no-tooltip="" translate="no">run_epic(config_key, type, options \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Runs a series of <a><code class="inline">Bonfire.Epics.Epic</code></a> operations based on configured Acts for this module.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#smart/4" data-no-tooltip="" translate="no">smart(epic, act, thing, label \\ &quot;&quot;)</a>

      </div>

        <div class="summary-synopsis"><p>Like <code class="inline">debug</code>, but will omit fully outputting the inspectable thing
and still print the message if only <code class="inline">:debug</code> is set</p></div>

    </div>

</div>

  </section>


  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Functions</span>
    </h1>
    <div class="functions-list">
<section class="detail" id="maybe_debug/3">

    <span id="maybe_debug/2"></span>

  <div class="detail-header">
    <a href="#maybe_debug/3" class="detail-link" data-no-tooltip="" aria-label="Link to this macro">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">maybe_debug(act_or_epic, thing, label \\ nil)</h1>

        <span class="note">(macro)</span>


        <a href="https://github.com/bonfire-networks/bonfire_epics/blob/main/lib/epics.ex#L65" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="maybe_debug/4">

  <div class="detail-header">
    <a href="#maybe_debug/4" class="detail-link" data-no-tooltip="" aria-label="Link to this macro">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">maybe_debug(epic, act, thing, label)</h1>

        <span class="note">(macro)</span>


        <a href="https://github.com/bonfire-networks/bonfire_epics/blob/main/lib/epics.ex#L54" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="run_epic/3">

    <span id="run_epic/2"></span>

  <div class="detail-header">
    <a href="#run_epic/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">run_epic(config_key, type, options \\ [])</h1>


        <a href="https://github.com/bonfire-networks/bonfire_epics/blob/main/lib/epics.ex#L27" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Runs a series of <a href="./Bonfire.Epics.Epic.html"><code class="inline">Bonfire.Epics.Epic</code></a> operations based on configured Acts for this module.</p><h2 id="run_epic/3-parameters" class="section-heading"><a href="#run_epic/3-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Parameters</span></h2><ul><li><code class="inline">config_key</code>: The config key from which to load the Epic definition, such as a module name.</li><li><code class="inline">type</code>: The type of epic operation to run.</li><li><code class="inline">options</code>: Options for the epic operation, including <code class="inline">:on</code> for the key in the epic assigns to return on success (default to <code class="inline">:result</code>).</li></ul><h2 id="run_epic/3-returns" class="section-heading"><a href="#run_epic/3-returns" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Returns</span></h2><p><code class="inline">{:ok, result}</code> on success, <code class="inline">{:error, reason}</code> on failure.</p><h2 id="run_epic/3-examples" class="section-heading"><a href="#run_epic/3-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="c1"># runs an Epic defined in config at `config :bonfire_posts, Bonfire.Posts, epics: [publish: [...]]`</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="nc">Bonfire.Epics</span><span class="o">.</span><span class="n">run_epic</span><span class="p" data-group-id="9797353783-1">(</span><span class="nc">Bonfire.Posts</span><span class="p">,</span><span class="w"> </span><span class="ss">:publish</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9797353783-2">[</span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="ss">:post</span><span class="p" data-group-id="9797353783-2">]</span><span class="p" data-group-id="9797353783-1">)</span><span class="w">
</span><span class="p" data-group-id="9797353783-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9797353783-4">%{</span><span class="p" data-group-id="9797353783-4">}</span><span class="p" data-group-id="9797353783-3">}</span></code></pre>
  </section>
</section>
<section class="detail" id="smart/4">

    <span id="smart/3"></span>

  <div class="detail-header">
    <a href="#smart/4" class="detail-link" data-no-tooltip="" aria-label="Link to this macro">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">smart(epic, act, thing, label \\ &quot;&quot;)</h1>

        <span class="note">(macro)</span>


        <a href="https://github.com/bonfire-networks/bonfire_epics/blob/main/lib/epics.ex#L80" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Like <code class="inline">debug</code>, but will omit fully outputting the inspectable thing
and still print the message if only <code class="inline">:debug</code> is set</p>
  </section>
</section>

    </div>
  </section>

    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="Bonfire.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.38.2) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
