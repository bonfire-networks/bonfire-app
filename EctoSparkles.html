<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.38.2">
    <meta name="project" content="Bonfire v1.0.0-social-rc.2.1">


    <title>EctoSparkles â€” Bonfire v1.0.0-social-rc.2.1</title>

    <link rel="stylesheet" href="dist/html-elixir-KV3YOVJ3.css" />

    <script defer src="dist/sidebar_items-E4AC60B8.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-DPJLHKSM.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="https://bonfirenetworks.org" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="Bonfire" />
        </a>

      <div>
        <a href="https://bonfirenetworks.org" class="sidebar-projectName" translate="no">
Bonfire
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v1.0.0-social-rc.2.1
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-module" id="main" data-type="modules">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of Bonfire</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>
      <span translate="no">EctoSparkles</span> 
      <small class="app-vsn" translate="no">(Bonfire v1.0.0-social-rc.2.1)</small>

    </h1>

      <a href="https://github.com/bonfire-networks/ecto_sparkles/blob/main/lib/ecto_sparkles.ex#L2" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


    <section id="moduledoc">
<p>Some helpers to sparkle on top of <a href="https://hexdocs.pm/ecto/Ecto.html">Ecto</a> </p><ul><li><a href="#proload-documentation"><code class="inline">EctoSparkles.proload/3</code></a> and <a href="#join_preload/2"><code class="inline">EctoSparkles.join_preload/2</code></a> to join and preload associations with less verbosity</li><li><a href="#reusable_join-documentation"><code class="inline">EctoSparkles.reusable_join/5</code></a> to avoid duplicating joins </li><li><a href="./EctoSparkles.Migrator.html"><code class="inline">EctoSparkles.Migrator</code></a> to run migrations, rollbacks, etc in a release and <a href="./EctoSparkles.AutoMigrator.html"><code class="inline">EctoSparkles.AutoMigrator</code></a> to automatically run them at startup.</li><li><a href="./EctoSparkles.DataMigration.html"><code class="inline">EctoSparkles.DataMigration</code></a>: a behaviour implemented for data migrations (generally backfills).</li><li><a href="./EctoSparkles.Log.html"><code class="inline">EctoSparkles.Log</code></a> to log slow or possible N+1 queries with telemetry (showing stacktraces)</li><li><a href="./EctoSparkles.Changesets.Errors.html"><code class="inline">EctoSparkles.Changesets.Errors</code></a> to generate readable errors for changesets</li></ul><p>NOTE: you need to put something like <code class="inline">config :ecto_sparkles, :otp_app, :your_otp_app_name</code> in your app's config.</p><h2 id="module-proload-documentation" class="section-heading"><a href="#module-proload-documentation" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text"><code class="inline">proload</code> documentation</span></h2><p>A macro which tells Ecto to perform a join and preload of associations.</p><p>By default, Ecto preloads associations using a separate query for each association, which can degrade performance.</p><p>You can make it run faster by using a combination of join/preload, but that requires a bit of boilerplate (see examples below).</p><h3 id="module-examples-using-standard-ecto" class="section-heading"><a href="#module-examples-using-standard-ecto" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples using standard Ecto</span></h3><pre><code class="makeup elixir" translate="no"><span class="w">  </span><span class="n">query</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">join</span><span class="p" data-group-id="3519376540-1">(</span><span class="ss">:left</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3519376540-2">[</span><span class="n">o</span><span class="p">,</span><span class="w"> </span><span class="ss">activity</span><span class="p">:</span><span class="w"> </span><span class="n">activity</span><span class="p" data-group-id="3519376540-2">]</span><span class="p">,</span><span class="w"> </span><span class="n">assoc</span><span class="p" data-group-id="3519376540-3">(</span><span class="ss">:object</span><span class="p" data-group-id="3519376540-3">)</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="ss">:object</span><span class="p" data-group-id="3519376540-1">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">preload</span><span class="p" data-group-id="3519376540-4">(</span><span class="p" data-group-id="3519376540-5">[</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="ss">activity</span><span class="p">:</span><span class="w"> </span><span class="n">activity</span><span class="p">,</span><span class="w"> </span><span class="ss">object</span><span class="p">:</span><span class="w"> </span><span class="n">object</span><span class="p" data-group-id="3519376540-5">]</span><span class="p">,</span><span class="w"> </span><span class="ss">activity</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="3519376540-6">{</span><span class="n">activity</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3519376540-7">[</span><span class="ss">object</span><span class="p">:</span><span class="w"> </span><span class="n">object</span><span class="p" data-group-id="3519376540-7">]</span><span class="p" data-group-id="3519376540-6">}</span><span class="p" data-group-id="3519376540-4">)</span></code></pre><p>Ecto requires calling three different functions for this operation: <code class="inline">Query.join/4</code>, <code class="inline">Query.assoc/3</code> and <code class="inline">Query.preload/2</code>. </p><p>Here's another example:</p><pre><code class="makeup elixir" translate="no"><span class="w">  </span><span class="nc">Invoice</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">join</span><span class="p" data-group-id="4600588381-1">(</span><span class="ss">:left</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4600588381-2">[</span><span class="n">i</span><span class="p" data-group-id="4600588381-2">]</span><span class="p">,</span><span class="w"> </span><span class="n">assoc</span><span class="p" data-group-id="4600588381-3">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="ss">:customer</span><span class="p" data-group-id="4600588381-3">)</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="ss">:customer</span><span class="p" data-group-id="4600588381-1">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">join</span><span class="p" data-group-id="4600588381-4">(</span><span class="ss">:left</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4600588381-5">[</span><span class="n">i</span><span class="p" data-group-id="4600588381-5">]</span><span class="p">,</span><span class="w"> </span><span class="n">assoc</span><span class="p" data-group-id="4600588381-6">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="ss">:lines</span><span class="p" data-group-id="4600588381-6">)</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="ss">:lines</span><span class="p" data-group-id="4600588381-4">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">preload</span><span class="p" data-group-id="4600588381-7">(</span><span class="p" data-group-id="4600588381-8">[</span><span class="ss">lines</span><span class="p">:</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="ss">customers</span><span class="p">:</span><span class="w"> </span><span class="n">c</span><span class="p" data-group-id="4600588381-8">]</span><span class="p">,</span><span class="w"> </span><span class="ss">lines</span><span class="p">:</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="ss">customer</span><span class="p">:</span><span class="w"> </span><span class="n">c</span><span class="p" data-group-id="4600588381-7">)</span></code></pre><h2 id="module-example-using-proload" class="section-heading"><a href="#module-example-using-proload" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Example using proload</span></h2><p>With <code class="inline">proload</code>, you can accomplish this with just one line of code:</p><pre><code class="makeup elixir" translate="no"><span class="n">proload</span><span class="p" data-group-id="7511753920-1">(</span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="ss">activity</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7511753920-2">[</span><span class="ss">:object</span><span class="p" data-group-id="7511753920-2">]</span><span class="p" data-group-id="7511753920-1">)</span></code></pre><p>And for the other example:</p><pre><code class="makeup elixir" translate="no"><span class="n">proload</span><span class="p" data-group-id="1058737258-1">(</span><span class="nc">Invoice</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1058737258-2">[</span><span class="ss">:customer</span><span class="p">,</span><span class="w"> </span><span class="ss">:lines</span><span class="p" data-group-id="1058737258-2">]</span><span class="p" data-group-id="1058737258-1">)</span></code></pre><p>As a bonus, it automatically makes use of <code class="inline">reusable_join</code> so calling it multiple times with the same association has no ill effects.</p><h2 id="module-example-using-join_preload" class="section-heading"><a href="#module-example-using-join_preload" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Example using join_preload</span></h2><p><code class="inline">join_preload</code> is <code class="inline">proload</code>'s sister macro with a slightly different syntax:</p><pre><code class="makeup elixir" translate="no"><span class="w">  </span><span class="n">join_preload</span><span class="p" data-group-id="2507632399-1">(</span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2507632399-2">[</span><span class="ss">:activity</span><span class="p">,</span><span class="w"> </span><span class="ss">:object</span><span class="p" data-group-id="2507632399-2">]</span><span class="p" data-group-id="2507632399-1">)</span></code></pre><p>and:</p><pre><code class="makeup elixir" translate="no"><span class="w">  </span><span class="nc">Invoice</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">join_preload</span><span class="p" data-group-id="2373580959-1">(</span><span class="ss">:customer</span><span class="p" data-group-id="2373580959-1">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">join_preload</span><span class="p" data-group-id="2373580959-2">(</span><span class="ss">:lines</span><span class="p" data-group-id="2373580959-2">)</span></code></pre><h2 id="module-reusable_join-documentation" class="section-heading"><a href="#module-reusable_join-documentation" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text"><code class="inline">reusable_join</code> documentation</span></h2><p>A macro similar to <code class="inline">Ecto.Query.join/{4,5}</code>, but can be called multiple times 
with the same alias.</p><p>Note that only the first join operation is performed, the subsequent ones that use the same alias
are just ignored. Also note that because of this behaviour, its mandatory to specify an alias when
using this function.</p><p>This is helpful when you need to perform a join while building queries one filter at a time,
because the same filter could be used multiple times or you could have multiple filters that
require the same join, which poses a problem with how the <code class="inline">filter/3</code> callback work, as you
need to return a dynamic with the filtering, which means that the join must have an alias,
and by default Ecto raises an error when you add multiple joins with the same alias.</p><p>To solve this, it is recommended to use this macro instead of the default <code class="inline">Ecto.Query.join/{4,5}</code>,
in which case there will be only one join in the query that can be reused by multiple filters.</p><h3 id="module-creating-reusable-joins" class="section-heading"><a href="#module-creating-reusable-joins" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Creating reusable joins</span></h3><pre><code class="makeup elixir" translate="no"><span class="n">query</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">reusable_join</span><span class="p" data-group-id="3222226874-1">(</span><span class="ss">:left</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3222226874-2">[</span><span class="n">t1</span><span class="p" data-group-id="3222226874-2">]</span><span class="p">,</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="s">&quot;other_table&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="n">t1</span><span class="o">.</span><span class="n">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">t2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="ss">:other_a</span><span class="p" data-group-id="3222226874-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">reusable_join</span><span class="p" data-group-id="3222226874-3">(</span><span class="ss">:left</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3222226874-4">[</span><span class="n">t1</span><span class="p" data-group-id="3222226874-4">]</span><span class="p">,</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="s">&quot;other_table&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="n">t1</span><span class="o">.</span><span class="n">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">t2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="ss">:other_b</span><span class="p" data-group-id="3222226874-3">)</span></code></pre><h2 id="module-copyright" class="section-heading"><a href="#module-copyright" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Copyright</span></h2><ul><li><p>Copyright (c) 2021 Bonfire developers</p></li><li><p>Copyright (c) 2020 Up Learn</p></li><li><p>Copyright (c) 2019 Joshua Nussbaum </p></li><li><p><code class="inline">join_preload</code> was originally forked from <a href="https://github.com/joshnuss/ecto_preloader">Ecto.Preloader</a>, licensed under WTFPL)</p></li><li><p><code class="inline">reusable_join</code> was originally forked from <a href="https://gitlab.com/up-learn-uk/query-elf">QueryElf</a>, licensed under Apache License Version 2.0</p></li><li><p>original code licensed under Apache License Version 2.0</p></li></ul>
    </section>

</div>

  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Summary</span>
    </h1>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#drop_join/2" data-no-tooltip="" translate="no">drop_join(query, binding_name)</a>

      </div>

        <div class="summary-synopsis"><p>Removes a specific named join from an Ecto query.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#join_override/5" data-no-tooltip="" translate="no">join_override(query, qual \\ :left, bindings, expr, opts)</a>

      </div>

        <div class="summary-synopsis"><p><code class="inline">join_override</code> is similar to <code class="inline">Ecto.Query.join/{4,5}</code>, but can be called multiple times with the same alias.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#join_preload/2" data-no-tooltip="" translate="no">join_preload(query, associations)</a>

      </div>

        <div class="summary-synopsis"><p><code class="inline">join_preload</code> is a helper for preloading associations using joins.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#proload/3" data-no-tooltip="" translate="no">proload(query, qual \\ :left, associations)</a>

      </div>

        <div class="summary-synopsis"><p>AKA <code class="inline">join_preload++</code>. It's more powerful, but it does it with more (and different!) syntax.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#remove_unused_joins/1" data-no-tooltip="" translate="no">remove_unused_joins(query)</a>

      </div>

        <div class="summary-synopsis"><p>Removes joins from an Ecto.Query that aren't referenced in other parts of the query.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#reusable_join/5" data-no-tooltip="" translate="no">reusable_join(query, qual \\ :left, bindings, expr, opts)</a>

      </div>

        <div class="summary-synopsis"><p><code class="inline">reusable_join</code> is similar to <code class="inline">Ecto.Query.join/{4,5}</code>, but can be called multiple times with the same alias.</p></div>

    </div>

</div>

  </section>


  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Functions</span>
    </h1>
    <div class="functions-list">
<section class="detail" id="drop_join/2">

  <div class="detail-header">
    <a href="#drop_join/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">drop_join(query, binding_name)</h1>


        <a href="https://github.com/bonfire-networks/ecto_sparkles/blob/main/lib/ecto_sparkles.ex#L543" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Removes a specific named join from an Ecto query.</p><h2 id="drop_join/2-parameters" class="section-heading"><a href="#drop_join/2-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Parameters</span></h2><ul><li><code class="inline">query</code>: The Ecto query to modify</li><li><code class="inline">binding_name</code>: The named binding (atom) used in the join's <code class="inline">:as</code> option</li></ul><h2 id="drop_join/2-examples" class="section-heading"><a href="#drop_join/2-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Post</span><span class="p">,</span><span class="w"> 
          </span><span class="ss">join</span><span class="p">:</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">assoc</span><span class="p" data-group-id="7183925817-1">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="ss">:comments</span><span class="p" data-group-id="7183925817-1">)</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="ss">:comments</span><span class="p">,</span><span class="w">
          </span><span class="ss">join</span><span class="p">:</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">assoc</span><span class="p" data-group-id="7183925817-2">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="ss">:user</span><span class="p" data-group-id="7183925817-2">)</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="ss">:user</span><span class="w">

</span><span class="c1"># Remove the comments join</span><span class="w">
</span><span class="n">drop_join</span><span class="p" data-group-id="7183925817-3">(</span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="ss">:comments</span><span class="p" data-group-id="7183925817-3">)</span></code></pre><h2 id="drop_join/2-warning" class="section-heading"><a href="#drop_join/2-warning" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Warning</span></h2><p>As noted in the Ecto documentation, if a join is removed and its bindings were referenced elsewhere in the query (in where clauses, select statements, etc.), the bindings won't be removed, leading to a query that won't compile. Make sure to only remove join bindings that aren't used elsewhere.</p>
  </section>
</section>
<section class="detail" id="join_override/5">

    <span id="join_override/4"></span>

  <div class="detail-header">
    <a href="#join_override/5" class="detail-link" data-no-tooltip="" aria-label="Link to this macro">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">join_override(query, qual \\ :left, bindings, expr, opts)</h1>

        <span class="note">(macro)</span>


        <a href="https://github.com/bonfire-networks/ecto_sparkles/blob/main/lib/ecto_sparkles.ex#L464" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p><code class="inline">join_override</code> is similar to <code class="inline">Ecto.Query.join/{4,5}</code>, but can be called multiple times with the same alias.</p><p>Unlike <code class="inline">reusable_join</code>, which skips subsequent joins with the same alias, <code class="inline">join_override</code> will replace any existing join with the same alias with the new one.</p><p>This is useful when you need to join the same table multiple times with different conditions, while avoiding the &quot;alias already exists&quot; error from Ecto.</p><p>Note that because of this behaviour, it is mandatory to specify an alias when using this function.</p><p>Warning: this macro is a work-in-progress, and while the test suite passes it doesn't seem to produce valid queries, resulting in errors like <code class="inline">(Postgrex.Error) ERROR 42P01 (undefined_table) missing FROM-clause entry for table &quot;sb8&quot;</code> when executed.</p>
  </section>
</section>
<section class="detail" id="join_preload/2">

  <div class="detail-header">
    <a href="#join_preload/2" class="detail-link" data-no-tooltip="" aria-label="Link to this macro">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">join_preload(query, associations)</h1>

        <span class="note">(macro)</span>


        <a href="https://github.com/bonfire-networks/ecto_sparkles/blob/main/lib/ecto_sparkles.ex#L38" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p><code class="inline">join_preload</code> is a helper for preloading associations using joins.</p><p>By default, Ecto preloads associations using a separate query for each association, which can degrade performance.
You could make it run faster by using a combination of join/preload, but that requires a bit of boilerplate (see example below).</p><p>With <a href="./EctoSparkles.html"><code class="inline">EctoSparkles</code></a>, you can accomplish this with just one line of code.</p><h2 id="join_preload/2-example-using-just-ecto" class="section-heading"><a href="#join_preload/2-example-using-just-ecto" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Example using just Ecto</span></h2><pre><code class="makeup elixir" translate="no"><span class="kn">import</span><span class="w"> </span><span class="nc">Ecto.Query</span><span class="w">
</span><span class="nc">Invoice</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">join</span><span class="p" data-group-id="5910514385-1">(</span><span class="ss">:left</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5910514385-2">[</span><span class="n">i</span><span class="p" data-group-id="5910514385-2">]</span><span class="p">,</span><span class="w"> </span><span class="n">assoc</span><span class="p" data-group-id="5910514385-3">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="ss">:customer</span><span class="p" data-group-id="5910514385-3">)</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="ss">:customer</span><span class="p" data-group-id="5910514385-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">join</span><span class="p" data-group-id="5910514385-4">(</span><span class="ss">:left</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5910514385-5">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p" data-group-id="5910514385-5">]</span><span class="p">,</span><span class="w"> </span><span class="n">assoc</span><span class="p" data-group-id="5910514385-6">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="ss">:account</span><span class="p" data-group-id="5910514385-6">)</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="ss">:account</span><span class="p" data-group-id="5910514385-4">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">join</span><span class="p" data-group-id="5910514385-7">(</span><span class="ss">:left</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5910514385-8">[</span><span class="n">i</span><span class="p" data-group-id="5910514385-8">]</span><span class="p">,</span><span class="w"> </span><span class="n">assoc</span><span class="p" data-group-id="5910514385-9">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="ss">:lines</span><span class="p" data-group-id="5910514385-9">)</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="ss">:lines</span><span class="p" data-group-id="5910514385-7">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">preload</span><span class="p" data-group-id="5910514385-10">(</span><span class="p" data-group-id="5910514385-11">[</span><span class="ss">lines</span><span class="p">:</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="ss">customers</span><span class="p">:</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="ss">account</span><span class="p">:</span><span class="w"> </span><span class="n">a</span><span class="p" data-group-id="5910514385-11">]</span><span class="p">,</span><span class="w"> </span><span class="ss">lines</span><span class="p">:</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="ss">customer</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5910514385-12">{</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5910514385-13">[</span><span class="ss">a</span><span class="p">:</span><span class="w"> </span><span class="n">account</span><span class="p" data-group-id="5910514385-13">]</span><span class="p" data-group-id="5910514385-12">}</span><span class="p" data-group-id="5910514385-10">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">all</span><span class="p" data-group-id="5910514385-14">(</span><span class="p" data-group-id="5910514385-14">)</span></code></pre><h2 id="join_preload/2-example-using-join_preload" class="section-heading"><a href="#join_preload/2-example-using-join_preload" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Example using <code class="inline">join_preload</code></span></h2><pre><code class="makeup elixir" translate="no"><span class="kn">import</span><span class="w"> </span><span class="nc">EctoSparkles</span><span class="w">
</span><span class="nc">Invoice</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">join_preload</span><span class="p" data-group-id="4845573159-1">(</span><span class="p" data-group-id="4845573159-2">[</span><span class="ss">:customer</span><span class="p">,</span><span class="w"> </span><span class="ss">:account</span><span class="p" data-group-id="4845573159-2">]</span><span class="p" data-group-id="4845573159-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">join_preload</span><span class="p" data-group-id="4845573159-3">(</span><span class="p" data-group-id="4845573159-4">[</span><span class="ss">:lines</span><span class="p" data-group-id="4845573159-4">]</span><span class="p" data-group-id="4845573159-3">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">all</span><span class="p" data-group-id="4845573159-5">(</span><span class="p" data-group-id="4845573159-5">)</span></code></pre>
  </section>
</section>
<section class="detail" id="proload/3">

    <span id="proload/2"></span>

  <div class="detail-header">
    <a href="#proload/3" class="detail-link" data-no-tooltip="" aria-label="Link to this macro">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">proload(query, qual \\ :left, associations)</h1>

        <span class="note">(macro)</span>


        <a href="https://github.com/bonfire-networks/ecto_sparkles/blob/main/lib/ecto_sparkles.ex#L100" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>AKA <code class="inline">join_preload++</code>. It's more powerful, but it does it with more (and different!) syntax.</p><p>e.g.</p><pre><code class="makeup elixir" translate="no"><span class="n">proload</span><span class="p" data-group-id="6754578363-1">(</span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="ss">activity</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6754578363-2">[</span><span class="w">
  </span><span class="ss">:verb</span><span class="p">,</span><span class="w"> </span><span class="ss">:boost_count</span><span class="p">,</span><span class="w"> </span><span class="ss">:like_count</span><span class="p">,</span><span class="w"> </span><span class="ss">:replied</span><span class="p">,</span><span class="w">
  </span><span class="c1"># relations under object will have their aliases prefixed with object_, i.e.</span><span class="w">
  </span><span class="c1"># :object_message, :object_post, :object_post_content</span><span class="w">
  </span><span class="c1"># the original names will still be used for the associations.</span><span class="w">
  </span><span class="ss">object</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6754578363-3">{</span><span class="s">&quot;object_&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6754578363-4">[</span><span class="ss">:message</span><span class="p">,</span><span class="w"> </span><span class="ss">:post</span><span class="p">,</span><span class="w"> </span><span class="ss">:post_content</span><span class="p" data-group-id="6754578363-4">]</span><span class="p" data-group-id="6754578363-3">}</span><span class="w">
</span><span class="p" data-group-id="6754578363-2">]</span><span class="p" data-group-id="6754578363-1">)</span></code></pre>
  </section>
</section>
<section class="detail" id="remove_unused_joins/1">

  <div class="detail-header">
    <a href="#remove_unused_joins/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">remove_unused_joins(query)</h1>


        <a href="https://github.com/bonfire-networks/ecto_sparkles/blob/main/lib/ecto_sparkles.ex#L359" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Removes joins from an Ecto.Query that aren't referenced in other parts of the query.</p><p>This function analyzes the query and removes any join whose binding is not used in select, where, order_by, group_by, having, limit, offset, or distinct clauses.</p><h2 id="remove_unused_joins/1-parameters" class="section-heading"><a href="#remove_unused_joins/1-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Parameters</span></h2><ul><li>query: An Ecto.Query struct to optimize</li></ul><h2 id="remove_unused_joins/1-returns" class="section-heading"><a href="#remove_unused_joins/1-returns" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Returns</span></h2><ul><li>The optimized Ecto.Query with unused joins removed</li></ul><h2 id="remove_unused_joins/1-examples" class="section-heading"><a href="#remove_unused_joins/1-examples" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">Examples</span></h2><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nc">Ecto.Query</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">User</span><span class="p">,</span><span class="w"> 
</span><span class="gp unselectable">...&gt; </span><span class="w">  </span><span class="ss">join</span><span class="p">:</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">u</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="w">  </span><span class="ss">join</span><span class="p">:</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Comment</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="n">c</span><span class="o">.</span><span class="n">post_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="w"> 
</span><span class="gp unselectable">...&gt; </span><span class="w">  </span><span class="ss">where</span><span class="p">:</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">published</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="p">,</span><span class="w"> 
</span><span class="gp unselectable">...&gt; </span><span class="w">  </span><span class="ss">select</span><span class="p">:</span><span class="w"> </span><span class="n">u</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="n">remove_unused_joins</span><span class="p" data-group-id="9828996754-1">(</span><span class="n">query</span><span class="p" data-group-id="9828996754-1">)</span><span class="w">
</span><span class="p" data-group-id="9828996754-2">#</span><span class="nc" data-group-id="9828996754-2">Ecto.Query</span><span class="p" data-group-id="9828996754-2">&lt;</span><span class="n">from</span><span class="w"> </span><span class="n">u0</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">User</span><span class="p">,</span><span class="w"> </span><span class="ss">join</span><span class="p">:</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">:</span><span class="w"> </span><span class="n">p1</span><span class="o">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">u0</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="ss">where</span><span class="p">:</span><span class="w"> </span><span class="n">p1</span><span class="o">.</span><span class="n">published</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="p">,</span><span class="w"> </span><span class="ss">select</span><span class="p">:</span><span class="w"> </span><span class="n">u0</span><span class="p" data-group-id="9828996754-2">&gt;</span></code></pre>
  </section>
</section>
<section class="detail" id="reusable_join/5">

    <span id="reusable_join/4"></span>

  <div class="detail-header">
    <a href="#reusable_join/5" class="detail-link" data-no-tooltip="" aria-label="Link to this macro">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">reusable_join(query, qual \\ :left, bindings, expr, opts)</h1>

        <span class="note">(macro)</span>


        <a href="https://github.com/bonfire-networks/ecto_sparkles/blob/main/lib/ecto_sparkles.ex#L256" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p><code class="inline">reusable_join</code> is similar to <code class="inline">Ecto.Query.join/{4,5}</code>, but can be called multiple times with the same alias.</p><p>Note that only the first join operation is performed, the subsequent ones that use the same alias are just ignored. Also note that because of this behaviour, it is mandatory to specify an alias when using this function.</p><p>This is helpful when you need to perform a join while building queries one filter at a time, because the same filter could be used multiple times or you could have multiple filters that require the same join, which poses a problem with how the <code class="inline">filter/3</code> callback work, as you
need to return a dynamic with the filtering, which means that the join must have an alias, and by default Ecto raises an error when you add multiple joins with the same alias.</p><p>To solve this, it is recommended to use this macro instead of the default <code class="inline">Ecto.Query.join/{4,5}</code>, in which case there will be only one join in the query that can be reused by multiple filters.</p>
  </section>
</section>

    </div>
  </section>

    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="Bonfire.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.38.2) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
